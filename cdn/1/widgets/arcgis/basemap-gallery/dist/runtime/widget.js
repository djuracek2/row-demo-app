System.register(["jimu-core","jimu-arcgis","jimu-ui","esri/widgets/BasemapGallery","esri/widgets/BasemapGallery/BasemapGalleryViewModel","esri/widgets/BasemapGallery/support/LocalBasemapsSource","esri/core/reactiveUtils","esri/Basemap","esri/widgets/BasemapGallery/support/BasemapGalleryItem"],(function(e,t){var a={},i={},n={},s={},o={},l={},r={},c={},u={};return{setters:[function(e){a.Immutable=e.Immutable,a.MutableStoreManager=e.MutableStoreManager,a.React=e.React,a.ReactRedux=e.ReactRedux,a.classNames=e.classNames,a.css=e.css,a.hooks=e.hooks,a.jsx=e.jsx},function(e){i.JimuMapViewComponent=e.JimuMapViewComponent,i.MapViewManager=e.MapViewManager,i.basemapUtils=e.basemapUtils},function(e){n.Loading=e.Loading,n.LoadingType=e.LoadingType,n.WidgetPlaceholder=e.WidgetPlaceholder},function(e){s.default=e.default},function(e){o.default=e.default},function(e){l.default=e.default},function(e){r.default=e.default},function(e){c.default=e.default},function(e){u.default=e.default}],execute:function(){e((()=>{var e={98782:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><g clip-path="url(#a)"><path fill="#000" fill-rule="evenodd" d="M1 1h7v7H1zM0 9V0h9v9zm12-8h7v7h-7zm-1 8V0h9v9zm-3 3H1v7h7zm-8-1v9h9v-9zm12 1h7v7h-7zm-1 8v-9h9v9z" clip-rule="evenodd"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h20v20H0z"></path></clipPath></defs></svg>'},63673:e=>{"use strict";e.exports=c},135:e=>{"use strict";e.exports=r},64946:e=>{"use strict";e.exports=s},37139:e=>{"use strict";e.exports=o},18815:e=>{"use strict";e.exports=u},56820:e=>{"use strict";e.exports=l},26826:e=>{"use strict";e.exports=i},48891:e=>{"use strict";e.exports=a},30726:e=>{"use strict";e.exports=n}},t={};function d(a){var i=t[a];if(void 0!==i)return i.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,d),n.exports}d.d=(e,t)=>{for(var a in t)d.o(t,a)&&!d.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},d.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),d.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},d.p="";var p={};return d.p=window.jimuConfig.baseUrl,(()=>{"use strict";d.r(p),d.d(p,{__set_webpack_public_path__:()=>y,default:()=>b});var e,t=d(48891),a=d(26826),i=d(30726),n=d(64946),s=d(37139),o=d(56820),l=d(135),r=d(63673);!function(e){e.Organization="ORGANIZATION",e.Custom="CUSTOM"}(e||(e={}));const c={_widgetLabel:"Basemap Gallery"};var u=d(18815);const m=(e,t)=>new u.default({basemap:e,view:t}),v=(0,t.Immutable)([]),f=(e,i,n)=>{const{id:s,mutableStateProps:o,useMapWidgetIds:l}=e,r=t.React.useMemo((()=>(null==o?void 0:o.cachedOrgBasemaps)||null),[null==o?void 0:o.cachedOrgBasemaps]),c=t.React.useCallback((e=>{t.MutableStoreManager.getInstance().updateStateValue(s,"cachedOrgBasemaps",e)}),[s]),u=t.React.useMemo((()=>(null==o?void 0:o.cachedOriginalBasemaps)||null),[null==o?void 0:o.cachedOriginalBasemaps]),d=t.React.useCallback((e=>{t.MutableStoreManager.getInstance().updateStateValue(s,"cachedOriginalBasemaps",e)}),[s]),p=t.React.useMemo((()=>(null==o?void 0:o.cachedBasemapGalleryInstance)||null),[null==o?void 0:o.cachedBasemapGalleryInstance]),m=t.React.useCallback((e=>{t.MutableStoreManager.getInstance().updateStateValue(s,"cachedBasemapGalleryInstance",e)}),[s]);t.hooks.useUpdateEffect((()=>()=>{d(g),m(n)}),[n]);const{set:f,store:g}=(e=>{const a=t.React.useRef(e);return{set:e=>{a.current=e},store:a.current}})(new Map);t.React.useEffect((()=>{(null==i?void 0:i.view)&&!g.get(i.id)&&g.set(i.id,i.view.map.basemap)}),[i,null==l?void 0:l[0]]);const h=t.ReactRedux.useSelector((e=>{var t,a;const i=null!==(t=e.appStateInBuilder)&&void 0!==t?t:e;return(null==l?void 0:l[0])?(null===(a=i.appConfig.widgets[l[0]])||void 0===a?void 0:a.useDataSources)||v:null}));return t.React.useEffect((()=>{if(h){const e=null==l?void 0:l[0],t=h.length?h.asMutable().map((t=>`${e}-${t.dataSourceId}`)):[`${e}-`];setTimeout((()=>{for(const e of g.keys())t.includes(e)||g.delete(e)}))}}),[h]),t.hooks.useUpdateEffect((()=>{(null==l?void 0:l[0])||f(new Map)}),[null==l?void 0:l[0]]),{hasGalleryCache:!!p,getOrgBasemaps:()=>{return e=void 0,t=void 0,n=function*(){if(r)return[...r];const e=yield a.basemapUtils.getOrgBasemaps();return c(e),e},new((i=void 0)||(i=Promise))((function(a,s){function o(e){try{r(n.next(e))}catch(e){s(e)}}function l(e){try{r(n.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,l)}r((n=n.apply(e,t||[])).next())}));var e,t,i,n},applyCache:e=>(p&&e.appendChild(p.container),u&&f(u),p),originalBasemaps:g}};var g=function(e,t,a,i){return new(a||(a=Promise))((function(n,s){function o(e){try{r(i.next(e))}catch(e){s(e)}}function l(e){try{r(i.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,l)}r((i=i.apply(e,t||[])).next())}))};const h=d(98782),w=t.css`
  &.jimu-basemap-widget {
    .gallery-container-parent{
      .esri-basemap-gallery.esri-component {
        width:100%;
        background-color: transparent !important;
        .esri-basemap-gallery__item {
          animation: none;
          transition: none;
        }
        .esri-basemap-gallery__item--selected {
          border-color: var(--primary-500);
        }
      }
      .esri-component.esri-widget--panel-height-only {
        max-height: none;
      }
      .esri-basemap-gallery:focus-within {
        outline: none;
      }
    }
  }
`,b=u=>{const{useMapWidgetIds:d,config:p,id:v}=u,{basemapsType:b,customBasemaps:y}=p,M=t.hooks.useTranslation(c),[x,B]=t.React.useState(!0),[R,S]=t.React.useState(null),[I,C]=t.React.useState(),O=t.React.useMemo((()=>null==I?void 0:I.viewModel.items),[null==I?void 0:I.viewModel.items]),{getOrgBasemaps:j,hasGalleryCache:E,applyCache:k,originalBasemaps:_}=f(u,R,I),V=()=>g(void 0,void 0,void 0,(function*(){let t=[];return t=b===e.Organization?yield j():yield a.basemapUtils.getLoadedBasemapList(r.default,y.asMutable()),t})),G=e=>{const t=_.get(e.id)||e.view.map.basemap;if(!t)return;if(O.find((e=>I.viewModel.basemapEquals(e.basemap,t))))return;const a=m(t,null==e?void 0:e.view);O.unshift(a)};t.hooks.useUpdateEffect((()=>{!(null==d?void 0:d[0])&&R.view&&(R.view.map.basemap=_.get(R.id))}),[null==d?void 0:d[0]]);((e,a,i,n)=>{const s=t.hooks.usePrevious(e);t.hooks.useUpdateEffect((()=>{let t;t=e.length>s.length?a:e<s?i:n,t(s,e)}),[e])})(y,((e,t)=>g(void 0,void 0,void 0,(function*(){const e=(a=t[t.length-1],new r.default({portalItem:{id:a.id}}));var a;O.push(m(e,R.view)),yield e.load(),I.viewModel.basemapEquals(_.get(R.id),e)&&O.shift()}))),((e,t)=>{const a=e.findIndex(((e,a)=>{var i;return e.id!==(null===(i=t[a])||void 0===i?void 0:i.id)})),i=e.length<O.length?a+1:a,n=O.splice(i,1)[0],s=I.activeBasemap;if(s&&I.viewModel.basemapEquals(n.basemap,s)){const e=_.get(R.id);G(R),I.activeBasemap=e}}),((e,t)=>{const a=((e,t)=>{if(e.length!==t.length||!e.length||!t.length)return null;const a=e.map(((e,t)=>({item:e,index:t}))).filter(((e,a)=>e.item!==t[a]));if(!a.length)return null;const i=t.map(((e,t)=>({item:e,index:t}))).slice(a[0].index,a[a.length-1].index+1);for(let e=0;e<a.length;e++){const t=a[e],n=i.findIndex((e=>e.item===t.item)),s=[...a];s.splice(e,1);const o=[...i];if(o.splice(n,1),s.every(((e,t)=>e.item===o[t].item)))return{from:t.index,to:i[n].index}}})(e.asMutable(),t.asMutable());if(!a)return;let{from:i,to:n}=a;e.length<O.length&&(i+=1,n+=1);const s=O.splice(i,1)[0];O.splice(n,0,s)})),t.hooks.useUpdateEffect((()=>{B(!0),V().then((e=>{I.viewModel.items.removeAll(),I.viewModel.items.addMany(e.map((e=>m(e,R.view)))),G(R);const t=_.get(R.id);I.viewModel.basemapEquals(t,I.activeBasemap)||e.find((e=>I.viewModel.basemapEquals(e,I.activeBasemap)))||(I.activeBasemap=t),B(!1)}))}),[b]);const P=t.React.useRef();return(null==d?void 0:d.length)?(0,t.jsx)("div",{className:"jimu-widget jimu-basemap-widget surface-1 border-0",css:w},(0,t.jsx)("div",{ref:e=>{if(e&&(P.current=e,!I)){const t=k(e);t&&(C(t),B(!1))}},role:"listbox",className:(0,t.classNames)("gallery-container-parent","h-100",{"d-none":x})}),x&&(0,t.jsx)(i.Loading,{type:i.LoadingType.Secondary}),(0,t.jsx)(a.JimuMapViewComponent,{useMapWidgetId:d[0],onActiveViewChange:(e,t)=>g(void 0,void 0,void 0,(function*(){if(S(e),I||E){if(I&&e){if(!t&&P.current.appendChild(I.container),e.id.split("-")[0]!==t.split("-")[0]){const e=a.MapViewManager.getInstance().getJimuMapViewById(t);(null==e?void 0:e.view)&&(e.view.map.basemap=_.get(t))}I.view=e.view,I.viewModel.items.forEach((t=>{t.view=e.view}));const i=yield V();I.source=new o.default({basemaps:i}),l.default.watch((()=>null==I?void 0:I.viewModel.items.map((e=>e.basemap.id))),(()=>{G(e)}),{once:!0})}}else i=e.view,g(void 0,void 0,void 0,(function*(){B(!0);const e=yield V(),t=document&&document.createElement("div");t.className="esri-component h-100 w-100";const a=null==i?void 0:i.map.basemap,o=new s.default,l=!!e.find((e=>o.basemapEquals(a,e)));o.destroy();const r=new n.default({view:i,source:l||!a?e:[a,...e],container:t});C(r),0===P.current.childElementCount?P.current.appendChild(t):P.current.replaceChildren(t),B(!1)}));var i}))})):(0,t.jsx)(i.WidgetPlaceholder,{icon:h,widgetId:v,message:M("_widgetLabel")})};function y(e){d.p=e}})(),p})())}}}));